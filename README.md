# homefarm
Tools for deploying and managing a BOINC compute farm using Ansible, Raspbian, and Alpine Linux.

Homefarm makes a few assumptions:

* You have a Raspberry Pi, to act as the control node.
* You have one or more machines capable of running Alpine Linux, to
  act as the compute nodes.
* You are comfortable doing basic Linux installs. Homefarm takes
  care of just about everything beyond the core install and network
  configuration, but getting to that point is on you.
* You are on a private network, because an SSH key with no passphrase
  will be autogenerated for Ansible's use.

# Setting up your farm

## Control node install

1. Image an SD card with [Raspbian
   Lite](https://www.raspberrypi.org/downloads/raspbian/), boot the
   Pi, and do any initial network/locale/etc configuration that you
   wish. (Recommended: enable the ssh daemon via `raspi-config`.)
   Reboot if necessary.
1. Login as the default user and run `'sudo apt-get --yes install git'`
1. Run `'git clone https://github.com/firepear/homefarm.git'`
1. Run `'cd homefarm && sudo ./control-setup'`. The Pi will reboot
   after this script completes.
1. Login after reboot and edit `farm.cfg`, which is our Ansible
   inventory. Change `node00` in the `[control]` stanza to match the
   name you've given the controller (AKA your Raspberry Pi). Then put
   the names of all machines you'll be setting up as compute nodes in
   the `[compute]` stanza.
1. Make sure the names and IP addresses of these machines are in your
   controller's `/etc/hosts` file.

The controller is now ready.

## Compute node install

Before installing a new compute node, login to the control node and
run `'cd ~/homefarm && ./bin/serve'`. This will start a Python webserver
to make available the `compute-setup` script and data needed by that
script. When done with installs, terminate the server with `Ctrl-C`.

On the compute node:

1. Download [Alpine Linux
   Standard](https://alpinelinux.org/downloads/) and install it.
1. Login after reboot
    1. If you are on WiFi, run `'/etc/init.d/wpa_supplicant start'` to
       bring up the networking
    1. Then run `'rc-update add wpa_supplicant boot'` to enable it for
       all future boots
1. Run `'wget [CONTROL_NODE_IP]:8000/compute-setup'` to fetch the
   compute node setup script from your control node.
1. Run `'sh ./compute-setup [CONTROL_NODE_IP]'`. This first run will
   update to Alpine's rolling release distro, and then reboot to
   ensure all libraries are up to date.
1. Log back after reboot and re-run `'sh ./compute-setup
   [CONTROL_NODE_IP]'` to complete bootstrapping.

At this point the compute node is ready for Ansible to take over its
configuration management. You can test that everything is working by
running `'ansible -m ping [NODE_NAME]'` from the control node.


# Managing the farm
